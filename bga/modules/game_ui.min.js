const STORAGE_TTL=12e5,GIVEUP_DURATION_STR="6666",GIVEUP_DURATION=6666,MAX_ROUNDS_DISPLAY=10,gameUI={hiddenPlayer:[],teamData:[],history:[],init:function(e){if(this.dojoGame||(this.dojoGame=e,this.playerId=e.player_id,this.isSpectator=e.isSpectator),!window.game)return void setTimeout((function(){gameUI.init(e)}),100);window.game.onLockChange=function(e){const t=e.some((e=>e.some((e=>!!e))));gameUI.lockedCells=t?e:void 0,gameUI.saveLockedCells()},window.game.onGridChange=function(e){if(JSON.stringify(gameUI.grid)!==JSON.stringify(e))if(gameUI.grid&&gameUI.history.push(gameUI.grid),gameUI.setGrid(e),gameUI.saveGrid(),100===gameUI.soloMode){const t=e?window.game.getSeed(e):"",i=gameUI._isSeedValid(t)?t:"";document.getElementById("lrf_design_input").value=i}else gameUI.shouldSendProgression=!0},window.game.onProgression=function(e){gameUI.progression=e},window.game.onPuzzleChange=function(e){"puzzleCreation"===gameUI.mode&&(gameUI.puzzle=e)},window.game.onPuzzleResolve=function(t){"play"===gameUI.mode&&(gameUI.setGrid(t),e.isCurrentPlayerActive()&&"playing"===gameUI.getMyData().state&&(gameUI.resolved=!0))},this.stateEmoticons={teamSelecting:"ü§®",teamSelected:"üëç",failed:"üòï",resting:"üòé",creating:"ü§®",created:"üòé",playing:"ü§®",design:"ü§®",success:"üòé",default:"üò¥"},this.stateLabels={teamSelecting:_("Team selection"),teamSelected:_("Team selected"),failed:_("Failed to solve the puzzle"),resting:_("It's my puzzle"),creating:_("In progress"),created:_("Puzzle created"),playing:_("In progress"),design:_("In progress"),success:_("Success"),default:_("Not yet started")};const securedLive=function(){try{gameUI.live()}catch(e){console.error("Error in gameUI.live",e)}};this.timeLimitStr=this.getDurationStr(60*this.timeLimit),securedLive(),setInterval(securedLive,500),window.game.setSmart(1==e.prefs[100].value),window.game.setHoverDisplay(1==e.prefs[101].value),window.game.setSimplifiedDisplay(2==e.prefs[103].value),window.game.setPartialSolutionAllowed(this.partialSolutionAllowed),this.liveLoop=0,this.initialized=!0},getMyData:function(){return this.players[this.playerId]},initLocalStorage:function(e,t){this.storageKey="lr_"+e+"_"+t,this.lockedStorageKey="lr_l_"+e+"_"+t,this.teamStorageKey="lr_t_"+e+"_"+t;const i=localStorage.length,s=(new Date).getTime(),o=[];for(let e=0;e<i;++e){const t=localStorage.key(e);if(t.startsWith("lr_")){const e=localStorage.getItem(t);JSON.parse(e).expires<s&&o.push(t)}}o.forEach((e=>localStorage.removeItem(e)))},resetLockedCells:function(){try{window.game.resetLockedCells()}catch(e){console.error("Exception occured in resetLockedCells",e)}},reset:function(){if(this.lockedCells&&this.grid){const e=this.grid.map(((e,t)=>e.map(((e,i)=>7===e||this.lockedCells[t][i]?e:0))));this.setGrid(e)}else this.setGrid(void 0);this.setup(),this.saveGrid(),this.history=[],this.shouldSendProgression=!0},undo:function(){if(this.history.length){const e=this.history.pop();this.setGrid(e),this.setup(),this.saveGrid(),this.shouldSendProgression=!0}},saveLockedCells:function(){if(this.lockedCells){const e={lockedCells:this.lockedCells,expires:(new Date).getTime()+12e5};localStorage.setItem(this.lockedStorageKey,JSON.stringify(e))}else localStorage.removeItem(this.lockedStorageKey)},getSavedLockedCells:function(){try{const e=localStorage.getItem(this.lockedStorageKey);if(e){return JSON.parse(e).lockedCells}}catch(e){}},saveGrid:function(){const e={grid:this.grid,expires:(new Date).getTime()+12e5};localStorage.setItem(this.storageKey,JSON.stringify(e))},_saveTeamData:function(){const e={team:this.teamData,expires:(new Date).getTime()+12e5};localStorage.setItem(this.teamStorageKey,JSON.stringify(e))},getSavedGrid:function(){try{const e=localStorage.getItem(this.storageKey);if(e){return JSON.parse(e).grid}}catch(e){}},_getSavedTeamData:function(){try{const e=localStorage.getItem(this.teamStorageKey);if(e){return JSON.parse(e).team}}catch(e){}},clearSavedGrid:function(){localStorage.removeItem(this.storageKey),this.history=[]},clearSavedTeamData:function(){localStorage.removeItem(this.teamStorageKey),this.teamData.forEach((e=>e.grid=void 0))},displayTeamEyes:function(){if(this.realtime&&!this.isSpectator&&!g_archive_mode){const e=this.getMyData().team,t=!this.ended&&(this.samePuzzle&&this.puzzleUser&&this.puzzleUser.id==this.playerId||e&&this.teamData.length&&"success"!==gameUI.players[this.playerId].state);Object.keys(gameUI.players).map((i=>{const s="lrf_disp_"+i;!t||i==this.playerId||e&&!this.teamData.some((e=>e.id==i))?document.getElementById(s).innerHTML="&nbsp;":document.getElementById(s).innerHTML=gameUI.getCheckBox(!gameUI.hiddenPlayer[i],"#000000")+"üëÄ"}))}},teamDisplay:function(e){this.hiddenPlayer[e]=!this.hiddenPlayer[e],this.shouldRefreshProgression=!0,this.refreshTeamData=!0},savePlayerData:function(e,t){const i={id:t,color:e.color,progression:parseInt(e.progression,10),grid:e.grid?JSON.parse(e.grid):void 0,puzzle:e.puzzle?JSON.parse(e.puzzle):void 0,name:e.name,startTime:parseInt(e.start,10),team:parseInt(e.team,10),num:parseInt(e.num,10)};i.running=i.startTime>0,i.running?"54"===e.state?i.state="success":i.state="playing":(i.duration=gameUI.getDurationStr(parseInt(e.duration,10)),"90"===e.state?i.state="teamSelecting":"91"===e.state?i.state="teamSelected":"30"===e.state?i.state="creating":"31"===e.state?i.state="created":"52"===e.state?i.state="failed":["51","54","80"].some((t=>e.state===t))&&100===i.progression?i.state="success":"80"===e.state&&"6666"===e.duration?i.state="failed":i.state="unknown"),this.players[t]=i},setCollectiveGiveup:function(e){this.collectiveGiveupTeams=[0].concat(e.teams.map((e=>+e))),this.collectiveGiveupPlayers=[0].concat(e.players.map((e=>+e)))},buildCollectiveGiveupArea:function(){dojo.place(this.dojoGame.format_block("jstpl_giveup",{giveup_decision_title:_("Would you like to giveup this round (you will receive a point penalty)?"),yes:_("Yes"),no:_("No")}),"left-side",12),$("giveup_decision_yes").onclick=function(){gameUI.giveUpPropose=!0},$("giveup_decision_no").onclick=function(){gameUI.giveUpRefuse=!0}},hideCollectiveGiveup:function(){if(this.teamsCount>0){const e=this.getMyData().team;gameUI.collectiveGiveupTeams[e]=0,Object.keys(gameUI.players).map((t=>{gameUI.players[t].team===e&&(gameUI.collectiveGiveupPlayers[gameUI.players[t].num]=0)})),this.displayCollectiveGiveup()}},displayCollectiveGiveup:function(){if(!this.ended&&this.teamsCount>0){const e=this.getMyData().team,t=this.collectiveGiveupTeams[e],i=[];t?(dojo.style("giveup-decision","display",""),Object.keys(this.players).map((t=>{const s=this.players[t].team,o=this.players[t].num,a=this.collectiveGiveupPlayers[o];s===e&&a&&i.push(this.players[t].name)})),document.getElementById("giveup-decision-players").innerHTML=i.join(", ")):dojo.style("giveup-decision","display","none")}},shouldAddTime:function(){if(!this.realtime||"play"!==this.mode)return!1;const e=document.getElementById("timeToThink_"+this.playerId).innerHTML;if(!("-"==e[0]||"0"==e[0]))return!1;const t=(new Date).getTime()/1e3;return!(this.lastAddTime&&t-this.lastAddTime<2)&&(this.lastAddTime=t,!0)},buildProgressionBars:function(){Object.keys(this.players).map((e=>{this.displayProgression(e,this.players[e].progression,this.players[e].startTime,this.players[e].duration)}))},buildTeamData:function(){const e=this._getSavedTeamData();if(e)return this.teamData=e,void(this.refreshTeamData=!0);const t=this.getMyData().team;t&&!this.teamData.length&&Object.keys(this.players).map((e=>{this.playerId!==+e&&this.players[e].team===t&&this.teamData.push({id:e,color:"#"+this.players[e].color})})),this.shouldRefreshProgression=!0},getTeamPlayersId:function(e){const t=[];return Object.keys(this.players).forEach((i=>{this.players[i].team===e&&t.push(i)})),t},_setTeam:function(){if(this.refreshTeamData){try{const e=this.teamData.filter((e=>{const t=this.players[e.id].state;return e.id!=this.playerId&&!this.hiddenPlayer[+e.id]&&("playing"===t||"success"===t)}));window.game.setTeam(e),this._saveTeamData(this.teamData)}catch(e){console.error("Error in setTeam",e,this.teamData)}this.refreshTeamData=!1}},live:function(){if(this.liveLoop=(this.liveLoop+1)%4,this._setTeam(),this.resolved&&(this.resolved=!1,this.giveUp=!1,this.timeout=!1,this.shouldSendProgression=!1,this.clearSavedGrid(),this.callAction("puzzleResolve",{grid:JSON.stringify(this.grid)},!0,"post",(e=>{e&&(this.saveGrid(),setTimeout((()=>{this.resolved=!0}),5e3))}))),this.giveUpPropose)this.giveUpPropose=!1,this.shouldSendProgression=!1,this.callAction("giveUpPropose",{grid:JSON.stringify(gameUI.grid)},!0,"post");else if(this.giveUpRefuse)this.giveUpRefuse=!1,this.shouldSendProgression=!1,this.callAction("giveUpRefuse",null,!0);else if(this.timeout||this.giveUp){const e=this.timeout?"timeout":"giveUp";this.shouldSendProgression=!1,this.giveUp=!1,this.timeout=!1,this.mode="solution",this.callAction(e,{grid:JSON.stringify(this.grid)},!0,"post",(t=>{t&&setTimeout((()=>{"timeout"===e?this.timeout=!0:this.giveUp=!0}),5e3)}))}else 0!==this.liveLoop&&2!==this.liveLoop||"play"!==this.mode||this.manageTimeLimit();if(this.puzzleCreationEnd&&(this.puzzleCreationEnd=!1,this.shouldSendProgression=!1,this.callAction("creationEnd",{grid:JSON.stringify(this.grid),puzzle:JSON.stringify(this.puzzle)},!0,"post"),this.clearSavedGrid()),this.shouldSendProgression&&(0===this.liveLoop||100===this.progression||this.teamData.length)&&(this.shouldSendProgression=!1,this.running&&!g_archive_mode&&("puzzleCreation"===this.mode||"play"===this.mode))){const t={grid:JSON.stringify(this.grid),progression:this.progression||0,give_time:this.shouldAddTime()};if(t.give_time){const e=document.getElementById("page-title");e.style.minHeight=window.getComputedStyle(e,null).getPropertyValue("height")}this.callAction("gridChange",t,t.give_time,"post",(()=>{e.style.minHeight="50px"}))}if(this.shouldRefreshProgression)this.buildProgressionBars(),this.displayBars(),this.displayTeamEyes(),this.shouldRefreshProgression=!1;else if(!this.ended){const e=Math.round((new Date).getTime()/1e3);Object.keys(this.players).map((t=>{const i=this.players[t];if((i.startTime||i.duration)&&(gameUI.realtime||gameUI.playerId==t)){let s=i.duration;s||g_archive_mode||(s=gameUI.getDurationStr(gameUI.getDuration(i.startTime,e))),gameUI._displayDuration(t,s)}}))}const e=document.getElementById("page-title"),t=document.getElementById("maingameview_menuheader"),i=document.getElementById("archivecontrol");let s=e.offsetHeight+90;t&&t.offsetHeight&&(s+=t.offsetHeight+30),i&&i.offsetHeight&&(s+=i.offsetHeight);const o=50*Math.floor(e.offsetWidth/50),a=50*Math.floor((window.innerHeight-s)/50);window.game.setAreaSize(o,a);try{dojo.query(".replay_last_move_button")[0].parentNode.parentNode.style.display="none"}catch(e){}},manageTimeLimit:function(){const e=document.getElementById("giveUp");if(e){const t=this.getMyData();if(t.startTime){const i=gameUI.getDuration(t.startTime),s=60*this.timeLimit-i;s<=0?this.timeout=!0:s<=30&&(e.innerHTML=_("Give up")+" ("+s+")")}}},setGrid:function(e){let t=0;e&&e.forEach((e=>{e.forEach((e=>{e&&7!==e&&t++}))})),this.grid=e,this.placedElements=t},_checkPortals:function(e){if(e&&4===e.length&&!(e[0]<0||e[1]<0||e[2]<0||e[3]<0))return e},isGridCorrect:function(){return!this._checkPortals(this.portals)||!this.grid||7===this.grid[this.portals[0]][this.portals[1]]&&7===this.grid[this.portals[2]][this.portals[3]]},setup:function(e){if(!this.initialized)return void setTimeout((function(){gameUI.setup(e)}),100);"play"!==this.mode&&"empty"!==this.mode||this.isGridCorrect()||(console.error("Invalid grid",this.grid),this.setGrid(void 0),this.saveGrid(),this.history=[]),this.grid&&(this.gridSize=this.grid.length),"play"!==this.mode&&this.lockedCells&&(this.lockedCells=void 0,this.saveLockedCells());const t={mode:this.mode,elements:this.elements,gridSize:this.gridSize,grid:this.grid,puzzle:this.puzzle,portals:this._checkPortals(this.portals),transformations:this.transfo||0,lockedCells:this.lockedCells};e&&Object.keys(e).forEach((i=>t[i]=e[i])),"solution"===this.mode||"solutionOnly"===this.mode?t.solution=this.solution:this.solution=null,this.grid=window.game.setup(t),"empty"===this.mode&&(this.puzzle=void 0),dojo.style("root","visibility","visible"),this.running&&!g_archive_mode||window.game.setRunning(!1)},callAction:function(e,t,i,s,o){this.dojoGame.callAction(e,t,i,s,o)},displayGrid:function(){console.info("## Display grid ##"),this.initialized&&window.game.resetLaser(),dojo.style("lrf_seed","display","none"),100===this.soloMode?(dojo.style("lrf_spectator_design_text","display","flex"),dojo.style("lrf_main","display","none")):!this.isSpectator||this.trainingMode||this.ended?(dojo.style("lrf_spectator_text","display","none"),dojo.style("lrf_main","display","flex")):(dojo.style("lrf_spectator_text","display","flex"),dojo.style("lrf_main","display","none"))},hideGrid:function(){console.info("## Hide grid ##"),dojo.style("lrf_main","display","none")},displayProgression:function(e,t,i,s){try{const o="lrf_info_"+e,a="lrf_progressbar_"+e,n="lrf_counter_"+e,l="lrf_container_"+e,r="lrf_textbar_"+e,d="lrf_emot_"+e,h="lrf_label_"+e,c="lrf_disp_"+e;s||!i||g_archive_mode||(s=this.getDurationStr(this.getDuration(i))),dojo.destroy(o),dojo.place(this.dojoGame.format_block("jstpl_progressbar",{iid:o,pid:a,cid:n,sid:l,tid:r,eid:d,lid:h,did:c,uid:e,color:this.players[e].color,progression:t,dec:100-t,text_disp:t>15?"":"none",counter:s?s+"&nbsp;/&nbsp;"+this.timeLimitStr:""}),"overall_player_board_"+e)}catch(e){console.error("Error in displayProgression",e)}},displayBars:function(){Object.keys(this.players).map((e=>{try{const t="lrf_progressbar_"+e,i="lrf_textbar_"+e,s="lrf_emot_"+e,o="lrf_label_"+e;let a=this.players[e].state;this.samePuzzle&&(this.isSpectator&&this.puzzleUsers&&this.puzzleUsers[e]==e&&(a="resting"),!this.isSpectator&&this.puzzleUser&&this.puzzleUser.id===e&&(a="resting")),document.getElementById(s).innerHTML=this.stateEmoticons[a]||this.stateEmoticons.default,document.getElementById(o).innerHTML=this.stateLabels[a]||this.stateLabels.default,(this.realtime||e==this.playerId)&&["creating","created","playing","success"].some((e=>e===a))?(dojo.style(t,"display",""),dojo.style(i,"display","none")):(dojo.style(t,"display","none"),dojo.style(i,"display",""))}catch(e){console.error("Error in displayBars",e)}}))},_displayDuration:function(e,t){const i="lrf_counter_"+e;try{document.getElementById(i).innerHTML=t+"&nbsp;/&nbsp;"+this.timeLimitStr}catch(e){console.error("Error in _displayDuration",e)}},getDuration:function(e,t){const i=(t||Math.round((new Date).getTime()/1e3))-e-this.serverTimeDec;return i<0?(this.serverTimeDec+=i,0):i},getDurationStr:function(e){if(!e)return"";if(6666===e)return"0:00";const t=e%60;return((e-t)/60).toString()+":"+t.toString().padStart(2,"0")},spyBoard:function(e){if(!this.trainingMode)return dojo.style("lrf_spectator_text","display","flex"),dojo.style("lrf_main","display","none"),void dojo.style("lrf_spectator","display","none");if(dojo.style("lrf_spectator_text","display","none"),dojo.style("lrf_main","display","flex"),dojo.style("lrf_spectator","display",this.playersCount>1?"flex":"none"),e&&(this.playerSpied=e,this.grid=this.players[e].grid),!this.modeRandom)if(this.puzzleUsers){const t=this.puzzleUsers[e];this.puzzle=this.players[t].puzzle}else this.puzzle=void 0;this.dojoGame&&this.setup()},buildRoundsPuzzleSelect:function(){this.resultRoundStart=10===this.puzzles.length&&this.round>10?this.round-10:0;for(let e=0;e<this.puzzles.length;e++)dojo.place("<option value='"+(e+this.resultRoundStart)+"'>"+_("Round")+" "+(e+this.resultRoundStart+1)+"</option>","roundSelect")},buildCopyButton:function(e,t){const i=document.getElementById(e);if(!i.title){const e="<svg aria-hidden='true' height='16' viewBox='0 0 16 16' width='16' data-view-component='true'><path fill-rule='evenodd' d='M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z'></path><path fill-rule='evenodd' d='M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z'></path>",s="<svg aria-hidden='true' height='16' viewBox='0 0 16 16' width='16' data-view-component='true'><g fill='#1a7f37'><path fill-rule='evenodd' d='M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z'></path></g></svg>";i.title=_("Copy to clipboard"),i.innerHTML=e,i.onclick=function(){const o=document.getElementById(t).value;navigator.clipboard.writeText(o).then((()=>{i.innerHTML=s,setTimeout((function(){i.innerHTML=e}),2e3)}))}}},displaySeedArea:function(){dojo.style("lrf_main","display","none"),dojo.style("lrf_seed","display","flex")},displayDesignArea:function(){if(dojo.style("lrf_design","display","flex"),dojo.place("lrf_design","page-title"),this.buildCopyButton("lrf_design_copy","lrf_design_input"),this.initialized)try{const e=this.grid?window.game.getSeed(this.grid):"";this._isSeedValid(e)&&(document.getElementById("lrf_design_input").value=e)}catch(e){}},hideDesignArea:function(){dojo.style("lrf_design","display","none")},_isSeedValid:function(e){let t=!0;const i=[],s=[];let o;try{o=window.game.getGrid(e),o.length<4?t=!1:(o.forEach(((e,o)=>e.forEach(((e,a)=>{e<0?t=!1:7===e?(s.push(o),s.push(a)):e>0&&i.push(e)})))),(0!==s.length&&4!==s.length||4===o.length&&i.length>14||5===o.length&&i.length>20||i.length>30||i.length<3)&&(t=!1))}catch(i){console.warn("Invalid seed code",e),t=!1}return t?[o,i,s]:[void 0,void 0,void 0]},seedValidate:function(e){const[t,i,s]=this._isSeedValid(e);t?(this.elements=i,this.elementsCount=i.length,this.gridSize=t.length,this.portals=this._checkPortals(s),this.callAction("seedValidate",{grid:JSON.stringify(t)},!0,"post")):this.dojoGame.showMessage(_("This is not a valid seed code"),"error")},_displaySeed:function(){window.game?(document.getElementById("lrf_end_seed_input").value=this.grid?window.game.getSeed(this.grid):"",this.buildCopyButton("lrf_end_seed_copy","lrf_end_seed_input")):setTimeout((function(){gameUI._displaySeed()}),500)},displayRoundPuzzle:function(e){console.info("## Display puzzle of round "+e+" ##"),dojo.style("lrf_spectator","display","none"),Object.keys(this.players).forEach((e=>{const t="lrf_end_"+e;document.getElementById(t).innerHTML="?"}));const t=String(e).padStart(4,"0"),i="pd_"+t+"_";this.grid=this.puzzles[e-this.resultRoundStart],this._displaySeed(),this.durations.filter((e=>e.pdk.startsWith(i))).forEach((e=>{const t=+e.pdk.substring(i.length),s="lrf_end_"+Object.keys(this.players).map((e=>this.players[e])).find((e=>e.num===t)).id,o="6666"===e.duration?_("Fail"):this.getDurationStr(+e.duration);document.getElementById(s).innerHTML=o}));const s=JSON.stringify(this.grid);Object.keys(this.players).forEach((e=>{const i="pg_"+t+"_"+this.players[e].num;document.getElementById("board_"+e).checked=!1;const o=this.boards.find((e=>e.pgk===i)),a=o&&o.grid?JSON.stringify(o.grid):void 0,n=null==a||a===s?"hidden":"visible";document.getElementById("board_"+e).style.visibility=n}));try{dojo.style("lrf_main","display","flex"),dojo.style("lrf_end","display","flex"),dojo.style("lrf_end_players","display","none"),dojo.style("lrf_end_rounds","display","flex"),this.mode="view",this.solution=null,this.dojoGame&&this.setup()}catch(e){console.error("Error in displayRoundPuzzle",e)}},displayPlayerPuzzle:function(e){console.info("## Display puzzle of player "+e+" ##");try{dojo.style("lrf_spectator","display","none"),dojo.style("lrf_main","display","flex"),dojo.style("lrf_end","display","flex"),dojo.style("lrf_end_players","display","flex"),dojo.style("lrf_end_rounds","display","none");const t=JSON.stringify(this.players[e].grid);Object.keys(this.players).forEach((e=>{const t="lrf_end_"+e;document.getElementById(t).innerHTML="?"})),Object.keys(this.players).forEach((i=>{const s="pg_"+this.players[e].num+"_"+this.players[i].num;document.getElementById("board_"+i).checked=!1;const o=this.boards.find((e=>e.pgk===s)),a=o&&o.grid?JSON.stringify(o.grid):void 0,n=null==a||a===t?"hidden":"visible";document.getElementById("board_"+i).style.visibility=n}));const i="pd_"+this.players[e].num+"_";Object.keys(this.players).forEach((t=>{const i="lrf_end_line_"+t,s=t==e?"none":"";dojo.style(i,"display",s)})),this.durations.filter((e=>e.pdk.startsWith(i))).forEach((e=>{const t=+e.pdk.substring(i.length),s="lrf_end_"+Object.keys(this.players).map((e=>this.players[e])).find((e=>e.num===t)).id,o="6666"===e.duration?_("Fail"):this.getDurationStr(+e.duration);document.getElementById(s).innerHTML=o})),this.mode="view",this.solution=null,this.grid=this.players[e].grid,this._displaySeed(),this.dojoGame&&this.setup()}catch(e){console.error("Error in displayPlayerPuzzle",e)}},displayBoard:function(e){Object.keys(this.players).filter((t=>t!=e)).forEach((e=>document.getElementById("board_"+e).checked=!1)),this.modeRandom?this._displayBoardRound(e):this._displayBoardPlayer(e)},_displayBoardRound:function(e){const t=document.getElementById("roundSelect").value,i=String(t).padStart(4,"0");if(document.getElementById("board_"+e).checked){const s=this.players[e],o="pg_"+i+"_"+s.num,a="pd_"+i+"_"+s.num,n=this.durations.find((e=>e.pdk===a));n&&"6666"!=n.duration?(this.mode="view",this.solution=null):(this.mode="solution",this.solution=this.puzzles[t-this.resultRoundStart]),this.puzzle=void 0,this.grid=this.boards.find((e=>e.pgk===o)).grid,this.dojoGame&&this.setup()}else this.displayRoundPuzzle(t)},_displayBoardPlayer:function(e){const t=document.getElementById("playerSelect").value;if(document.getElementById("board_"+e).checked){const i=this.players[e],s=this.players[t],o="pg_"+s.num+"_"+i.num,a="pd_"+s.num+"_"+i.num,n=this.durations.find((e=>e.pdk===a));n&&"6666"!=n.duration?(this.mode="view",this.solution=null,this.grid=this.boards.find((e=>e.pgk===o)).grid):(this.mode="solution",this.solution=s.grid,this.puzzle=void 0,this.grid=this.boards.find((e=>e.pgk===o)).grid),this.dojoGame&&this.setup()}else this.displayPlayerPuzzle(t)},refreshPuzzle:function(e){try{if(!e&&this.playerSpied&&(e=this.playerSpied),this.playerSpied===e){if(this.grid=this.players[e].grid,!this.modeRandom)if(this.isSpectator&&this.puzzleUsers&&!this.ended){const t=this.puzzleUsers[e];this.puzzle=this.players[t].puzzle}else this.puzzle=void 0;this.setup()}}catch(e){console.error("Error in refreshPuzzle",e)}},displayTeamSelection:function(){dojo.style("lrf_main","display","none"),dojo.style("lrf_teams","display","flex");const e=this.getMyData().team;e&&dojo.addClass("lrf_team_"+e,"lrf_team_selected"),2==this.teamsCount&&dojo.style("lrf_team_3","display","none")},hideTeamSelection:function(){dojo.style("lrf_main","display",""),dojo.style("lrf_teams","display","none")},selectTeam:function(e){for(let t=1;t<=3;t++)e===t?dojo.addClass("lrf_team_"+t,"lrf_team_selected"):dojo.removeClass("lrf_team_"+t,"lrf_team_selected");const t=this.getMyData();t.team!==e&&this.callAction("teamSelect",{no:t.num,team:e},!0)},displayPlayerTeam:function(e){const t="player_name_"+e,i="icon_team_"+e,s=["","üßô","üßõ","üëΩ"][this.players[e].team];dojo.destroy(i),dojo.place("<span id='"+i+"'>"+s+"&nbsp;</span>",$(t).firstElementChild,0)},displayPlayerHearts:function(e,t){void 0===t&&(t=this.isSpectator?this.playerSpied:this.playerId);const i="player_board_"+t,s="icon_heart_"+t,o=e>=0?e+"&nbsp;üíó":"0&nbsp;üíî";dojo.destroy(s),dojo.place("<span id='"+s+"'>&nbsp;&nbsp;&nbsp;"+o+"&nbsp;</span>",$(i).firstElementChild,4)},displayPlayerIcons:function(){this.soloMode&&this.soloMode<100?this.displayPlayerHearts(this.hearts):this.teamsCount&&Object.keys(this.players).map((e=>{this.displayPlayerTeam(e),this.cooperativeMode&&this.displayPlayerHearts(this.hearts,e)}))},getCheckBox:function(e,t){return e?'<svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="'+t+'" fill-rule="nonzero"><path d="M18.25,3 C19.7687831,3 21,4.23121694 21,5.75 L21,18.25 C21,19.7687831 19.7687831,21 18.25,21 L5.75,21 C4.23121694,21 3,19.7687831 3,18.25 L3,5.75 C3,4.23121694 4.23121694,3 5.75,3 L18.25,3 Z M18.25,4.5 L5.75,4.5 C5.05964406,4.5 4.5,5.05964406 4.5,5.75 L4.5,18.25 C4.5,18.9403559 5.05964406,19.5 5.75,19.5 L18.25,19.5 C18.9403559,19.5 19.5,18.9403559 19.5,18.25 L19.5,5.75 C19.5,5.05964406 18.9403559,4.5 18.25,4.5 Z M10,14.4393398 L16.4696699,7.96966991 C16.7625631,7.6767767 17.2374369,7.6767767 17.5303301,7.96966991 C17.7965966,8.23593648 17.8208027,8.65260016 17.6029482,8.94621165 L17.5303301,9.03033009 L10.5303301,16.0303301 C10.2640635,16.2965966 9.84739984,16.3208027 9.55378835,16.1029482 L9.46966991,16.0303301 L6.46966991,13.0303301 C6.1767767,12.7374369 6.1767767,12.2625631 6.46966991,11.9696699 C6.73593648,11.7034034 7.15260016,11.6791973 7.44621165,11.8970518 L7.53033009,11.9696699 L10,14.4393398 L16.4696699,7.96966991 L10,14.4393398 Z"></path></g></svg>':'<svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="'+t+'" fill-rule="nonzero"><path d="M5.75,3 L18.25,3 C19.7687831,3 21,4.23121694 21,5.75 L21,18.25 C21,19.7687831 19.7687831,21 18.25,21 L5.75,21 C4.23121694,21 3,19.7687831 3,18.25 L3,5.75 C3,4.23121694 4.23121694,3 5.75,3 Z M5.75,4.5 C5.05964406,4.5 4.5,5.05964406 4.5,5.75 L4.5,18.25 C4.5,18.9403559 5.05964406,19.5 5.75,19.5 L18.25,19.5 C18.9403559,19.5 19.5,18.9403559 19.5,18.25 L19.5,5.75 C19.5,5.05964406 18.9403559,4.5 18.25,4.5 L5.75,4.5 Z"></path></g></svg>'},getUnlockIcon:function(){return'<svg width="12px" height="12px" viewBox="0 0 92.179 92.18"><g stroke="none" fill="#ffffff" fill-rule="nonzero"><path d="M73.437,36.54v-9.192C73.437,12.268,61.169,0,46.09,0S18.744,12.268,18.744,27.348h11.355 c0-8.818,7.173-15.992,15.991-15.992c8.817,0,15.991,7.174,15.991,15.992v9.192H9.884v55.64h72.411V36.54H73.437z M50.609,71.115 V83.33h-9.037V71.115c-2.102-1.441-3.482-3.858-3.482-6.6c0-4.418,3.582-8,8-8s8,3.582,8,8 C54.09,67.257,52.71,69.674,50.609,71.115z"/></g></svg>'},doAdd:function(){const e=window.chrome,t=window.navigator,i=t.vendor,s=void 0!==window.opr,o=t.userAgent.match("CriOS");if(!localStorage.getItem("lrx_disp")&&!o&&null!=e&&"Google Inc."===i&&!1===s){const e=window.navigator.userLanguage||window.navigator.language,t='<div id="lrf-bga-extension" class="roundedbox"><span style="position:absolute; top:0px; left:0px; padding:0.5em">'+(e&&e.startsWith("fr")?'L\'auteur de ce jeu a √©galement cr√©√© une extension Chrome pour BGA. Pour en savoir plus, cliquez <a href="https://chrome.google.com/webstore/detail/boardgamearena-extension/jdiekdaapekbemobdeacplcfmignidoc" target="_blank">ici</a>.</span><a href="#" class="action-button bgabutton bgabutton_blue" onclick="document.getElementById(\'lrf-bga-extension\').style.display=\'none\'" style="position:absolute; bottom:-5px; right:10px;">Non merci</a>':'The author of this game has also created a Chrome extension for BGA. You can find out more <a href="https://chrome.google.com/webstore/detail/boardgamearena-extension/jdiekdaapekbemobdeacplcfmignidoc" target="_blank">here</a>.</span><a href="#" class="action-button bgabutton bgabutton_blue" onclick="document.getElementById(\'lrf-bga-extension\').style.display=\'none\'" style="position:absolute; bottom:-5px; right:10px;">Nope, thanks</a>')+'<svg height="100" viewBox="20 -20 200 170"><g clip-path="url(#SVGID-00000069372319379759664590000016439136492548043392)"><linearGradient id="SVGID-00000005268409276694585540000015853986965625284781" gradientUnits="userSpaceOnUse" x1="39.16" y1="775.015" x2="152.84" y2="775.015" gradientTransform="matrix(1 0 0 1 0 -650)"><stop offset="0" style="stop-color:#d93025"></stop><stop offset="1" style="stop-color:#ea4335"></stop></linearGradient><path fill="url(#SVGID-00000005268409276694585540000015853986965625284781)" d="M39.16,116.8l9.05,27.61l19.38,21.63 L96,116.81l56.84-0.01C141.49,97.18,120.29,83.99,96,83.99S50.51,97.18,39.16,116.8z"></path><linearGradient id="SVGID-00000175289037886816495430000013271641968500087969" gradientUnits="userSpaceOnUse" x1="-1169.8269" y1="59.7414" x2="-1056.1232" y2="59.7414" gradientTransform="matrix(-0.5 -0.866 0.866 -0.5 -533.5404 -772.0297)"><stop offset="0" style="stop-color:#1e8e3e"></stop><stop offset="1" style="stop-color:#34a853"></stop></linearGradient><path fill="url(#SVGID-00000175289037886816495430000013271641968500087969)" d="M95.99,215.28l19.38-21.64l9.04-27.6H67.58 L39.16,116.8c-11.31,19.64-12.14,44.61,0.01,65.65C51.31,203.49,73.34,215.26,95.99,215.28z"></path><linearGradient id="SVGID-00000025418581839675921930000004546302552040502431" gradientUnits="userSpaceOnUse" x1="56.7071" y1="-664.7747" x2="170.4071" y2="-664.7747" gradientTransform="matrix(-0.5 0.866 -0.866 -0.5 -403.9008 -264.818)"><stop offset="0" style="stop-color:#fbbc04"></stop><stop offset="1" style="stop-color:#fcc934"></stop></linearGradient><path fill="url(#SVGID-00000025418581839675921930000004546302552040502431)" d="M152.84,116.81H96l28.42,49.23L96,215.28 c22.66-0.02,44.69-11.79,56.83-32.83C164.98,161.41,164.15,136.45,152.84,116.81z"></path><ellipse fill="#F1F3F4" cx="96" cy="149.63" rx="32.81" ry="32.82"></ellipse><ellipse fill="#1A73E8" cx="96" cy="149.63" rx="26.66" ry="26.67"></ellipse></g><svg></div>',i=document.createElement("DIV");i.className="log",i.style.height="auto",i.style.display="block",i.style.color="rgb(0,0,0)",i.innerHTML=t,document.getElementById("chatlogs").prepend(i),localStorage.setItem("lrx_disp",(new Date).getTime())}}};